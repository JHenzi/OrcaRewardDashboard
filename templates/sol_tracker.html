<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOL Price Tracker - RSI Trading Signals</title>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- TradingView Lightweight Charts - Professional Trading Chart Library -->
    <!-- Using v4.x for compatibility (v5.x has breaking API changes) -->
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        /* Professional Trading Chart Styles */
        #tradingview-chart {
            width: 100%;
            height: 500px;
            background: #1a1a1a;
            border-radius: 8px;
            position: relative;
        }
        #rsi-chart {
            width: 100%;
            height: 150px;
            background: #1a1a1a;
            border-radius: 8px;
            margin-top: 10px;
        }
        .chart-container {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .signal-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .signal-buy { background: #10b981; }
        .signal-sell { background: #ef4444; }
        .signal-hold { background: #f59e0b; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/" class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üêã</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Orca Tracker</h1>
                            <p class="text-xs text-gray-400">Solana Rewards & Trading</p>
                        </div>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition text-sm font-medium">
                        Home
                    </a>
                    <a href="/orca" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition text-sm font-medium">
                        Rewards
                    </a>
                    <a href="/sol-tracker" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg transition text-sm font-medium">
                        SOL Tracker
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <!-- Large Price Display - Top Priority -->
        <div class="mb-8 fade-in">
            <div class="bg-gradient-to-r {% if stats.percent_change is not none and stats.percent_change > 0 %}from-green-600 to-emerald-600{% elif stats.percent_change is not none and stats.percent_change < 0 %}from-red-600 to-rose-600{% else %}from-purple-600 to-blue-600{% endif %} rounded-2xl shadow-2xl p-8 border-2 {% if stats.percent_change is not none and stats.percent_change > 0 %}border-green-400{% elif stats.percent_change is not none and stats.percent_change < 0 %}border-red-400{% else %}border-purple-400{% endif %}">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div class="flex items-center space-x-6 mb-4 md:mb-0">
                        <div class="text-6xl md:text-7xl">
                            {% if stats.percent_change is not none and stats.percent_change > 0 %}
                                üìà
                            {% elif stats.percent_change is not none and stats.percent_change < 0 %}
                                üìâ
                            {% else %}
                                üí∞
                            {% endif %}
                        </div>
                        <div>
                            <div class="text-sm md:text-base text-white/80 mb-2 font-medium">SOLANA (SOL)</div>
                            <div class="text-5xl md:text-6xl font-extrabold text-white">
                                ${{ "%.2f"|format(stats.current_price) if stats.current_price is not none else 'N/A' }}
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-start md:items-end space-y-2">
                        <div class="text-sm text-white/80 font-medium">24h Change</div>
                        <div class="flex items-center space-x-3">
                            {% if stats.percent_change is not none %}
                                <div class="text-4xl md:text-5xl font-extrabold text-white">
                                    {% if stats.percent_change > 0 %}‚¨ÜÔ∏è{% elif stats.percent_change < 0 %}‚¨áÔ∏è{% else %}‚û°Ô∏è{% endif %}
                                    {{ "%.2f"|format(stats.percent_change) }}%
                                </div>
                            {% else %}
                                <div class="text-4xl md:text-5xl font-extrabold text-white/50">N/A</div>
                            {% endif %}
                        </div>
                        {% if stats.high is not none and stats.low is not none %}
                            <div class="text-sm text-white/70 mt-2">
                                High: ${{ "%.2f"|format(stats.high) }} / Low: ${{ "%.2f"|format(stats.low) }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Time Range Selector -->
            <div class="mt-4 flex justify-end">
                <form method="get" action="/sol-tracker" class="flex items-center space-x-2">
                    <label for="range" class="text-sm font-medium text-gray-300">Time Range:</label>
                    <select id="range" name="range" onchange="this.form.submit()" class="bg-gray-700 border border-gray-600 text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block px-4 py-2 shadow-sm hover:bg-gray-600 transition">
                        <option value="hour" {% if selected_range == 'hour' %}selected{% endif %}>1 Hour</option>
                        <option value="day" {% if selected_range == 'day' %}selected{% endif %}>1 Day</option>
                        <option value="week" {% if selected_range == 'week' %}selected{% endif %}>1 Week</option>
                        <option value="month" {% if selected_range == 'month' %}selected{% endif %}>1 Month</option>
                        <option value="year" {% if selected_range == 'year' %}selected{% endif %}>1 Year</option>
                    </select>
                </form>
            </div>
        </div>

        <!-- Professional Trading Chart - Second Priority -->
        <div class="mb-8 fade-in">
            <div class="chart-container">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">SOL/USD Price Chart</h2>
                    <div class="text-sm text-gray-400">
                        <span id="chart-price" class="text-2xl font-bold text-green-400">$0.00</span>
                        <span id="chart-change" class="ml-2"></span>
                    </div>
                </div>
                <div id="tradingview-chart"></div>
                <div id="rsi-chart"></div>
            </div>
        </div>

        <!-- RSI-Based Trading Signal -->
        <div class="mb-8 fade-in">
          {% if stats.rsi is not none %}
            {% if stats.rsi < 30 %}
              <!-- BUY Signal - RSI Oversold -->
              <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl shadow-2xl p-8 border-2 border-green-400 animate-pulse">
                <div class="text-center">
                  <div class="text-5xl font-extrabold mb-4 flex items-center justify-center space-x-4">
                    <span>üü¢ BUY SIGNAL</span>
                  </div>
                  <div class="text-2xl mb-4 opacity-90">RSI indicates oversold conditions</div>
                  <div class="grid grid-cols-3 gap-6 mt-6">
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">RSI Value</div>
                      <div class="text-3xl font-bold">{{ "%.1f"|format(stats.rsi) }}</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Current Price</div>
                      <div class="text-3xl font-bold">${{ "%.2f"|format(stats.current_price) if stats.current_price is not none else 'N/A' }}</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Signal Strength</div>
                      <div class="text-3xl font-bold">Strong</div>
                    </div>
                  </div>
                  <div class="mt-6 text-sm opacity-75 italic">
                    RSI below 30 suggests potential buying opportunity. Consider entering long positions.
                  </div>
                </div>
              </div>
            {% elif stats.rsi > 70 %}
              <!-- SELL Signal - RSI Overbought -->
              <div class="bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-xl shadow-2xl p-8 border-2 border-red-400 animate-pulse">
                <div class="text-center">
                  <div class="text-5xl font-extrabold mb-4 flex items-center justify-center space-x-4">
                    <span>üî¥ SELL SIGNAL</span>
                  </div>
                  <div class="text-2xl mb-4 opacity-90">RSI indicates overbought conditions</div>
                  <div class="grid grid-cols-3 gap-6 mt-6">
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">RSI Value</div>
                      <div class="text-3xl font-bold">{{ "%.1f"|format(stats.rsi) }}</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Current Price</div>
                      <div class="text-3xl font-bold">${{ "%.2f"|format(stats.current_price) if stats.current_price is not none else 'N/A' }}</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Signal Strength</div>
                      <div class="text-3xl font-bold">Strong</div>
                    </div>
                  </div>
                  <div class="mt-6 text-sm opacity-75 italic">
                    RSI above 70 suggests potential selling opportunity. Consider taking profits or entering short positions.
                  </div>
                </div>
              </div>
            {% else %}
              <!-- HOLD Signal - RSI Neutral -->
              <div class="bg-gradient-to-r from-gray-700 to-gray-800 text-white rounded-xl shadow-xl p-8 border border-gray-600">
                <div class="text-center">
                  <div class="text-5xl font-extrabold mb-4 flex items-center justify-center space-x-4">
                    <span>üü° HOLD SIGNAL</span>
                  </div>
                  <div class="text-2xl mb-4 opacity-90">RSI indicates neutral conditions</div>
                  <div class="grid grid-cols-3 gap-6 mt-6">
                    <div class="bg-gray-600/30 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">RSI Value</div>
                      <div class="text-3xl font-bold">{{ "%.1f"|format(stats.rsi) }}</div>
                    </div>
                    <div class="bg-gray-600/30 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Current Price</div>
                      <div class="text-3xl font-bold">${{ "%.2f"|format(stats.current_price) if stats.current_price is not none else 'N/A' }}</div>
                    </div>
                    <div class="bg-gray-600/30 rounded-lg p-4">
                      <div class="text-sm opacity-80 mb-1">Signal Strength</div>
                      <div class="text-3xl font-bold">Neutral</div>
                    </div>
                  </div>
                  <div class="mt-6 text-sm opacity-75 italic">
                    RSI between 30-70 suggests neutral market conditions. Wait for clearer signals before taking action.
                  </div>
                </div>
              </div>
            {% endif %}
          {% else %}
            <div class="bg-gray-800 border border-gray-700 rounded-xl p-8 text-center">
              <div class="text-xl font-semibold text-gray-400">Insufficient data for RSI calculation</div>
              <div class="text-sm text-gray-500 mt-2">Need at least 15 price points to calculate RSI</div>
            </div>
          {% endif %}
        </div>

        <!-- Comprehensive Technical Signals Panel -->
        <div class="mb-8 fade-in">
          <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center space-x-2">
              <span>üìä</span>
              <span>Technical Indicator Signals</span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              
              <!-- RSI Signal -->
              {% if stats.rsi is not none %}
                {% if stats.rsi < 30 %}
                  {% set rsi_signal = 'BUY' %}
                  {% set rsi_color = 'green' %}
                  {% set rsi_arrow = '‚¨ÜÔ∏è' %}
                  {% set rsi_message = 'Oversold - Buy Opportunity' %}
                {% elif stats.rsi > 70 %}
                  {% set rsi_signal = 'SELL' %}
                  {% set rsi_color = 'red' %}
                  {% set rsi_arrow = '‚¨áÔ∏è' %}
                  {% set rsi_message = 'Overbought - Sell Opportunity' %}
                {% else %}
                  {% set rsi_signal = 'HOLD' %}
                  {% set rsi_color = 'yellow' %}
                  {% set rsi_arrow = '‚û°Ô∏è' %}
                  {% set rsi_message = 'Neutral - Wait for Clear Signal' %}
                {% endif %}
              {% else %}
                {% set rsi_signal = 'N/A' %}
                {% set rsi_color = 'gray' %}
                {% set rsi_arrow = '‚Äî' %}
                {% set rsi_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if rsi_color == 'green' %}border-green-500/50{% elif rsi_color == 'red' %}border-red-500/50{% elif rsi_color == 'yellow' %}border-yellow-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">RSI (14)</span>
                  <span class="text-2xl">{{ rsi_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if rsi_color == 'green' %}text-green-400{% elif rsi_color == 'red' %}text-red-400{% elif rsi_color == 'yellow' %}text-yellow-400{% else %}text-gray-400{% endif %}">
                    {{ rsi_signal }}
                  </span>
                  {% if stats.rsi is not none %}
                    <span class="text-sm text-gray-400">({{ "%.1f"|format(stats.rsi) }})</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ rsi_message }}</p>
              </div>

              <!-- Price vs SMA 1h -->
              {% if stats.price_vs_sma_1h is not none %}
                {% if stats.price_vs_sma_1h > 2 %}
                  {% set sma1h_signal = 'BULLISH' %}
                  {% set sma1h_color = 'green' %}
                  {% set sma1h_arrow = '‚¨ÜÔ∏è' %}
                  {% set sma1h_message = 'Price well above 1h average' %}
                {% elif stats.price_vs_sma_1h < -2 %}
                  {% set sma1h_signal = 'BEARISH' %}
                  {% set sma1h_color = 'red' %}
                  {% set sma1h_arrow = '‚¨áÔ∏è' %}
                  {% set sma1h_message = 'Price well below 1h average' %}
                {% else %}
                  {% set sma1h_signal = 'NEUTRAL' %}
                  {% set sma1h_color = 'gray' %}
                  {% set sma1h_arrow = '‚û°Ô∏è' %}
                  {% set sma1h_message = 'Price near 1h average' %}
                {% endif %}
              {% else %}
                {% set sma1h_signal = 'N/A' %}
                {% set sma1h_color = 'gray' %}
                {% set sma1h_arrow = '‚Äî' %}
                {% set sma1h_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if sma1h_color == 'green' %}border-green-500/50{% elif sma1h_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">Price vs SMA (1h)</span>
                  <span class="text-2xl">{{ sma1h_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if sma1h_color == 'green' %}text-green-400{% elif sma1h_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ sma1h_signal }}
                  </span>
                  {% if stats.price_vs_sma_1h is not none %}
                    <span class="text-sm text-gray-400">({{ "%+.2f"|format(stats.price_vs_sma_1h) }}%)</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ sma1h_message }}</p>
              </div>

              <!-- Price vs SMA 4h -->
              {% if stats.price_vs_sma_4h is not none %}
                {% if stats.price_vs_sma_4h > 2 %}
                  {% set sma4h_signal = 'BULLISH' %}
                  {% set sma4h_color = 'green' %}
                  {% set sma4h_arrow = '‚¨ÜÔ∏è' %}
                  {% set sma4h_message = 'Price well above 4h average' %}
                {% elif stats.price_vs_sma_4h < -2 %}
                  {% set sma4h_signal = 'BEARISH' %}
                  {% set sma4h_color = 'red' %}
                  {% set sma4h_arrow = '‚¨áÔ∏è' %}
                  {% set sma4h_message = 'Price well below 4h average' %}
                {% else %}
                  {% set sma4h_signal = 'NEUTRAL' %}
                  {% set sma4h_color = 'gray' %}
                  {% set sma4h_arrow = '‚û°Ô∏è' %}
                  {% set sma4h_message = 'Price near 4h average' %}
                {% endif %}
              {% else %}
                {% set sma4h_signal = 'N/A' %}
                {% set sma4h_color = 'gray' %}
                {% set sma4h_arrow = '‚Äî' %}
                {% set sma4h_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if sma4h_color == 'green' %}border-green-500/50{% elif sma4h_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">Price vs SMA (4h)</span>
                  <span class="text-2xl">{{ sma4h_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if sma4h_color == 'green' %}text-green-400{% elif sma4h_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ sma4h_signal }}
                  </span>
                  {% if stats.price_vs_sma_4h is not none %}
                    <span class="text-sm text-gray-400">({{ "%+.2f"|format(stats.price_vs_sma_4h) }}%)</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ sma4h_message }}</p>
              </div>

              <!-- Price vs SMA 24h -->
              {% if stats.price_vs_sma_24h is not none %}
                {% if stats.price_vs_sma_24h > 2 %}
                  {% set sma24h_signal = 'BULLISH' %}
                  {% set sma24h_color = 'green' %}
                  {% set sma24h_arrow = '‚¨ÜÔ∏è' %}
                  {% set sma24h_message = 'Price well above 24h average' %}
                {% elif stats.price_vs_sma_24h < -2 %}
                  {% set sma24h_signal = 'BEARISH' %}
                  {% set sma24h_color = 'red' %}
                  {% set sma24h_arrow = '‚¨áÔ∏è' %}
                  {% set sma24h_message = 'Price well below 24h average' %}
                {% else %}
                  {% set sma24h_signal = 'NEUTRAL' %}
                  {% set sma24h_color = 'gray' %}
                  {% set sma24h_arrow = '‚û°Ô∏è' %}
                  {% set sma24h_message = 'Price near 24h average' %}
                {% endif %}
              {% else %}
                {% set sma24h_signal = 'N/A' %}
                {% set sma24h_color = 'gray' %}
                {% set sma24h_arrow = '‚Äî' %}
                {% set sma24h_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if sma24h_color == 'green' %}border-green-500/50{% elif sma24h_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">Price vs SMA (24h)</span>
                  <span class="text-2xl">{{ sma24h_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if sma24h_color == 'green' %}text-green-400{% elif sma24h_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ sma24h_signal }}
                  </span>
                  {% if stats.price_vs_sma_24h is not none %}
                    <span class="text-sm text-gray-400">({{ "%+.2f"|format(stats.price_vs_sma_24h) }}%)</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ sma24h_message }}</p>
              </div>

              <!-- MACD Signal -->
              {% if stats.macd_line is not none and stats.macd_signal is not none %}
                {% if stats.macd_line > stats.macd_signal and stats.macd_histogram > 0 %}
                  {% set macd_signal = 'BULLISH' %}
                  {% set macd_color = 'green' %}
                  {% set macd_arrow = '‚¨ÜÔ∏è' %}
                  {% set macd_message = 'MACD above signal - Uptrend' %}
                {% elif stats.macd_line < stats.macd_signal and stats.macd_histogram < 0 %}
                  {% set macd_signal = 'BEARISH' %}
                  {% set macd_color = 'red' %}
                  {% set macd_arrow = '‚¨áÔ∏è' %}
                  {% set macd_message = 'MACD below signal - Downtrend' %}
                {% else %}
                  {% set macd_signal = 'NEUTRAL' %}
                  {% set macd_color = 'gray' %}
                  {% set macd_arrow = '‚û°Ô∏è' %}
                  {% set macd_message = 'MACD crossing - Wait' %}
                {% endif %}
              {% else %}
                {% set macd_signal = 'N/A' %}
                {% set macd_color = 'gray' %}
                {% set macd_arrow = '‚Äî' %}
                {% set macd_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if macd_color == 'green' %}border-green-500/50{% elif macd_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">MACD</span>
                  <span class="text-2xl">{{ macd_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if macd_color == 'green' %}text-green-400{% elif macd_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ macd_signal }}
                  </span>
                  {% if stats.macd_histogram is not none %}
                    <span class="text-sm text-gray-400">({{ "%+.4f"|format(stats.macd_histogram) }})</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ macd_message }}</p>
              </div>

              <!-- Bollinger Bands Position -->
              {% if stats.bb_position is not none %}
                {% if stats.bb_position > 80 %}
                  {% set bb_signal = 'OVERBOUGHT' %}
                  {% set bb_color = 'red' %}
                  {% set bb_arrow = '‚¨áÔ∏è' %}
                  {% set bb_message = 'Price near upper band - Sell zone' %}
                {% elif stats.bb_position < 20 %}
                  {% set bb_signal = 'OVERSOLD' %}
                  {% set bb_color = 'green' %}
                  {% set bb_arrow = '‚¨ÜÔ∏è' %}
                  {% set bb_message = 'Price near lower band - Buy zone' %}
                {% else %}
                  {% set bb_signal = 'NEUTRAL' %}
                  {% set bb_color = 'gray' %}
                  {% set bb_arrow = '‚û°Ô∏è' %}
                  {% set bb_message = 'Price in middle range' %}
                {% endif %}
              {% else %}
                {% set bb_signal = 'N/A' %}
                {% set bb_color = 'gray' %}
                {% set bb_arrow = '‚Äî' %}
                {% set bb_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if bb_color == 'green' %}border-green-500/50{% elif bb_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">Bollinger Bands</span>
                  <span class="text-2xl">{{ bb_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if bb_color == 'green' %}text-green-400{% elif bb_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ bb_signal }}
                  </span>
                  {% if stats.bb_position is not none %}
                    <span class="text-sm text-gray-400">({{ "%.0f"|format(stats.bb_position) }}%)</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ bb_message }}</p>
              </div>

              <!-- Momentum -->
              {% if stats.momentum_10 is not none %}
                {% if stats.momentum_10 > 1 %}
                  {% set momentum_signal = 'BULLISH' %}
                  {% set momentum_color = 'green' %}
                  {% set momentum_arrow = '‚¨ÜÔ∏è' %}
                  {% set momentum_message = 'Strong upward momentum' %}
                {% elif stats.momentum_10 < -1 %}
                  {% set momentum_signal = 'BEARISH' %}
                  {% set momentum_color = 'red' %}
                  {% set momentum_arrow = '‚¨áÔ∏è' %}
                  {% set momentum_message = 'Strong downward momentum' %}
                {% else %}
                  {% set momentum_signal = 'NEUTRAL' %}
                  {% set momentum_color = 'gray' %}
                  {% set momentum_arrow = '‚û°Ô∏è' %}
                  {% set momentum_message = 'Weak momentum' %}
                {% endif %}
              {% else %}
                {% set momentum_signal = 'N/A' %}
                {% set momentum_color = 'gray' %}
                {% set momentum_arrow = '‚Äî' %}
                {% set momentum_message = 'Insufficient Data' %}
              {% endif %}
              
              <div class="bg-gray-700/50 rounded-lg p-4 border {% if momentum_color == 'green' %}border-green-500/50{% elif momentum_color == 'red' %}border-red-500/50{% else %}border-gray-600{% endif %}">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-gray-300">Momentum (10)</span>
                  <span class="text-2xl">{{ momentum_arrow }}</span>
                </div>
                <div class="flex items-center space-x-2 mb-1">
                  <span class="text-lg font-bold {% if momentum_color == 'green' %}text-green-400{% elif momentum_color == 'red' %}text-red-400{% else %}text-gray-400{% endif %}">
                    {{ momentum_signal }}
                  </span>
                  {% if stats.momentum_10 is not none %}
                    <span class="text-sm text-gray-400">({{ "%+.2f"|format(stats.momentum_10) }}%)</span>
                  {% endif %}
                </div>
                <p class="text-xs text-gray-400">{{ momentum_message }}</p>
              </div>

            </div>

            <!-- Overall Signal Summary -->
            <div class="mt-6 pt-4 border-t border-gray-700">
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-gray-300">Signal Consensus:</span>
                <div class="flex items-center space-x-2">
                  {% set bullish_count = 0 %}
                  {% set bearish_count = 0 %}
                  {% set neutral_count = 0 %}
                  
                  {% if rsi_signal == 'BUY' or rsi_signal == 'SELL' %}
                    {% if rsi_signal == 'BUY' %}{% set bullish_count = bullish_count + 1 %}{% else %}{% set bearish_count = bearish_count + 1 %}{% endif %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if sma1h_signal == 'BULLISH' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif sma1h_signal == 'BEARISH' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if sma4h_signal == 'BULLISH' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif sma4h_signal == 'BEARISH' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if sma24h_signal == 'BULLISH' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif sma24h_signal == 'BEARISH' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if macd_signal == 'BULLISH' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif macd_signal == 'BEARISH' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if bb_signal == 'OVERSOLD' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif bb_signal == 'OVERBOUGHT' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if momentum_signal == 'BULLISH' %}{% set bullish_count = bullish_count + 1 %}
                  {% elif momentum_signal == 'BEARISH' %}{% set bearish_count = bearish_count + 1 %}
                  {% else %}{% set neutral_count = neutral_count + 1 %}{% endif %}
                  
                  {% if bullish_count > bearish_count and bullish_count > neutral_count %}
                    <span class="text-lg font-bold text-green-400">üü¢ BULLISH ({{ bullish_count }}/7)</span>
                  {% elif bearish_count > bullish_count and bearish_count > neutral_count %}
                    <span class="text-lg font-bold text-red-400">üî¥ BEARISH ({{ bearish_count }}/7)</span>
                  {% else %}
                    <span class="text-lg font-bold text-yellow-400">üü° MIXED ({{ neutral_count }} neutral)</span>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- News Sentiment Analysis -->
        {% if news_features %}
        <div class="mb-8 fade-in">
          <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center space-x-2">
              <span>üì∞</span>
              <span>News Sentiment Analysis (24h)</span>
            </h2>
            
            {% if news_features.news_count > 0 %}
              {% set sentiment_score = news_features.news_sentiment_score %}
              {% set sentiment_label = news_features.news_sentiment_label %}
              
              {% if sentiment_score > 0.3 %}
                {% set sentiment_color = 'green' %}
                {% set sentiment_icon = 'üìà' %}
                {% set sentiment_message = 'Positive news sentiment - generally bullish for crypto' %}
              {% elif sentiment_score < -0.3 %}
                {% set sentiment_color = 'red' %}
                {% set sentiment_icon = 'üìâ' %}
                {% set sentiment_message = 'Negative news sentiment - generally bearish for crypto' %}
              {% else %}
                {% set sentiment_color = 'yellow' %}
                {% set sentiment_icon = '‚û°Ô∏è' %}
                {% set sentiment_message = 'Neutral news sentiment - mixed signals' %}
              {% endif %}
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Main Sentiment Card -->
                <div class="bg-gradient-to-br {% if sentiment_color == 'green' %}from-green-600 to-emerald-600{% elif sentiment_color == 'red' %}from-red-600 to-rose-600{% else %}from-yellow-600 to-amber-600{% endif %} rounded-xl p-6 border-2 {% if sentiment_color == 'green' %}border-green-400{% elif sentiment_color == 'red' %}border-red-400{% else %}border-yellow-400{% endif %}">
                  <div class="flex items-center justify-between mb-4">
                    <span class="text-4xl">{{ sentiment_icon }}</span>
                    <span class="text-sm font-semibold text-white/80 uppercase tracking-wide">{{ sentiment_label }}</span>
                  </div>
                  <div class="mb-2">
                    <p class="text-sm text-white/90 mb-1">Sentiment Score</p>
                    <p class="text-3xl font-bold text-white">{{ "%.2f"|format(sentiment_score) }}</p>
                    <p class="text-xs text-white/70 mt-1">Range: -1.0 (very bad) to +1.0 (very good)</p>
                  </div>
                  <p class="text-sm text-white/90 italic">{{ sentiment_message }}</p>
                </div>
                
                <!-- News Statistics -->
                <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600">
                  <h3 class="text-lg font-semibold text-white mb-4">News Statistics</h3>
                  <div class="space-y-3">
                    <div class="flex justify-between items-center">
                      <span class="text-gray-300">Total Articles</span>
                      <span class="text-xl font-bold text-white">{{ news_features.news_count }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-gray-300">Crypto-Related</span>
                      <span class="text-lg font-semibold text-blue-400">{{ news_features.news_crypto_count }}</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-gray-600">
                      <span class="text-gray-300">Positive</span>
                      <span class="text-lg font-semibold text-green-400">{{ news_features.news_positive_count }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-gray-300">Negative</span>
                      <span class="text-lg font-semibold text-red-400">{{ news_features.news_negative_count }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mt-6 pt-4 border-t border-gray-700">
                <p class="text-xs text-gray-400 italic">
                  News sentiment is analyzed using local embeddings and sentiment classification. 
                  The system tracks news from multiple sources (crypto, finance, tech, general) and identifies 
                  crypto-related articles. Sentiment scores are based on historical training data.
                </p>
              </div>
            {% else %}
              <div class="bg-gray-700/50 rounded-lg p-8 text-center border border-gray-600">
                <div class="text-4xl mb-4">üì∞</div>
                <div class="text-xl font-semibold text-gray-300 mb-2">No Recent News</div>
                <div class="text-sm text-gray-400">
                  News articles are being fetched in the background. Check back soon for sentiment analysis.
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- Latest Bandit Recommendation -->
        {% if latest_bandit %}
        <div class="mb-8 fade-in">
          <div class="bg-gradient-to-r from-purple-800 to-indigo-800 text-white rounded-xl shadow-2xl p-8 border-2 border-purple-500">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold flex items-center space-x-3">
                <span>ü§ñ</span>
                <span>Contextual Bandit Recommendation</span>
              </h2>
              <div class="text-sm text-purple-200">
                {{ latest_bandit.timestamp }}
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Action Recommendation -->
              <div class="bg-white/10 rounded-lg p-6">
                <div class="text-sm text-purple-200 mb-2">Recommended Action</div>
                <div class="flex items-center space-x-4">
                  {% if latest_bandit.action == 'buy' %}
                    <div class="text-5xl font-extrabold text-green-400">üü¢ BUY</div>
                  {% elif latest_bandit.action == 'sell' %}
                    <div class="text-5xl font-extrabold text-red-400">üî¥ SELL</div>
                  {% else %}
                    <div class="text-5xl font-extrabold text-yellow-400">üü° HOLD</div>
                  {% endif %}
                  <div>
                    <div class="text-2xl font-bold">{{ latest_bandit.action|upper }}</div>
                    {% if latest_bandit.reward is not none %}
                      <div class="text-sm text-purple-200 mt-1">
                        Reward: {{ "%.4f"|format(latest_bandit.reward) }}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <!-- Prediction Scores -->
              <div class="bg-white/10 rounded-lg p-6">
                <div class="text-sm text-purple-200 mb-4">Prediction Scores</div>
                <div class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">Buy Prediction:</span>
                    <span class="font-bold {% if latest_bandit.prediction_buy is not none and latest_bandit.prediction_buy > 0 %}text-green-400{% else %}text-gray-400{% endif %}">
                      {{ "%.4f"|format(latest_bandit.prediction_buy) if latest_bandit.prediction_buy is not none else 'N/A' }}
                    </span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">Sell Prediction:</span>
                    <span class="font-bold {% if latest_bandit.prediction_sell is not none and latest_bandit.prediction_sell > 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                      {{ "%.4f"|format(latest_bandit.prediction_sell) if latest_bandit.prediction_sell is not none else 'N/A' }}
                    </span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">Hold Prediction:</span>
                    <span class="font-bold {% if latest_bandit.prediction_hold is not none and latest_bandit.prediction_hold > 0 %}text-yellow-400{% else %}text-gray-400{% endif %}">
                      {{ "%.4f"|format(latest_bandit.prediction_hold) if latest_bandit.prediction_hold is not none else 'N/A' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-purple-600/50">
              <p class="text-sm text-purple-200 italic">
                The contextual bandit algorithm analyzes market conditions and recommends actions based on learned patterns. 
                This recommendation is for informational purposes only and should be used alongside other technical indicators.
              </p>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Signal Performance & Reliability -->
        <div class="mb-8 fade-in">
          <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center space-x-2">
              <span>üìà</span>
              <span>Signal Reliability & Performance</span>
            </h2>
            <p class="text-sm text-gray-400 mb-6">Track how reliable each signal type has been over time (24-hour performance)</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              
              <!-- RSI Buy Signal Performance -->
              {% if performance_stats.rsi_buy and performance_stats.rsi_buy.signals_with_outcome > 0 %}
                {% set rsi_buy = performance_stats.rsi_buy %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if rsi_buy.win_rate >= 60 %}border-green-500/50{% elif rsi_buy.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">RSI Buy Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if rsi_buy.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif rsi_buy.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(rsi_buy.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ rsi_buy.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if rsi_buy.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(rsi_buy.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(rsi_buy.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(rsi_buy.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">RSI Buy Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

              <!-- RSI Sell Signal Performance -->
              {% if performance_stats.rsi_sell and performance_stats.rsi_sell.signals_with_outcome > 0 %}
                {% set rsi_sell = performance_stats.rsi_sell %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if rsi_sell.win_rate >= 60 %}border-green-500/50{% elif rsi_sell.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">RSI Sell Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if rsi_sell.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif rsi_sell.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(rsi_sell.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ rsi_sell.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if rsi_sell.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(rsi_sell.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(rsi_sell.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(rsi_sell.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">RSI Sell Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

              <!-- RSI Hold Signal Performance -->
              {% if performance_stats.rsi_hold and performance_stats.rsi_hold.signals_with_outcome > 0 %}
                {% set rsi_hold = performance_stats.rsi_hold %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if rsi_hold.win_rate >= 60 %}border-green-500/50{% elif rsi_hold.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">RSI Hold Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if rsi_hold.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif rsi_hold.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(rsi_hold.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ rsi_hold.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if rsi_hold.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(rsi_hold.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(rsi_hold.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(rsi_hold.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">RSI Hold Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

              <!-- Bandit Buy Signal Performance -->
              {% if performance_stats.bandit_buy and performance_stats.bandit_buy.signals_with_outcome > 0 %}
                {% set bandit_buy = performance_stats.bandit_buy %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if bandit_buy.win_rate >= 60 %}border-green-500/50{% elif bandit_buy.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">Bandit Buy Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if bandit_buy.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif bandit_buy.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(bandit_buy.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ bandit_buy.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if bandit_buy.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(bandit_buy.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(bandit_buy.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(bandit_buy.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">Bandit Buy Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

              <!-- Bandit Sell Signal Performance -->
              {% if performance_stats.bandit_sell and performance_stats.bandit_sell.signals_with_outcome > 0 %}
                {% set bandit_sell = performance_stats.bandit_sell %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if bandit_sell.win_rate >= 60 %}border-green-500/50{% elif bandit_sell.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">Bandit Sell Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if bandit_sell.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif bandit_sell.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(bandit_sell.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ bandit_sell.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if bandit_sell.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(bandit_sell.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(bandit_sell.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(bandit_sell.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">Bandit Sell Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

              <!-- Bandit Hold Signal Performance -->
              {% if performance_stats.bandit_hold and performance_stats.bandit_hold.signals_with_outcome > 0 %}
                {% set bandit_hold = performance_stats.bandit_hold %}
                <div class="bg-gray-700/50 rounded-lg p-4 border {% if bandit_hold.win_rate >= 60 %}border-green-500/50{% elif bandit_hold.win_rate >= 50 %}border-yellow-500/50{% else %}border-red-500/50{% endif %}">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-gray-300">Bandit Hold Signal</span>
                    <span class="text-xs px-2 py-1 rounded {% if bandit_hold.win_rate >= 60 %}bg-green-500/20 text-green-400{% elif bandit_hold.win_rate >= 50 %}bg-yellow-500/20 text-yellow-400{% else %}bg-red-500/20 text-red-400{% endif %}">
                      {{ "%.0f"|format(bandit_hold.win_rate) }}% Win Rate
                    </span>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Total Signals:</span>
                      <span class="text-white font-medium">{{ bandit_hold.total_signals }}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Avg Return (24h):</span>
                      <span class="{% if bandit_hold.avg_return > 0 %}text-green-400{% else %}text-red-400{% endif %} font-bold">
                        {{ "%+.2f"|format(bandit_hold.avg_return) }}%
                      </span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Best:</span>
                      <span class="text-green-400 font-medium">{{ "%+.2f"|format(bandit_hold.max_return) }}%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-400">Worst:</span>
                      <span class="text-red-400 font-medium">{{ "%+.2f"|format(bandit_hold.min_return) }}%</span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                  <div class="text-sm font-semibold text-gray-400 mb-2">Bandit Hold Signal</div>
                  <div class="text-xs text-gray-500">Insufficient data</div>
                </div>
              {% endif %}

            </div>

            <!-- Summary Note -->
            <div class="mt-6 pt-4 border-t border-gray-700">
              <p class="text-xs text-gray-400 italic">
                Performance metrics are calculated based on price movement 24 hours after each signal. 
                Win rate indicates the percentage of signals that resulted in profitable outcomes. 
                Data accumulates over time as signals age and outcomes are measured.
              </p>
            </div>
          </div>
        </div>

        <div class="mt-8 bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
            <h2 class="text-xl font-semibold mb-4 text-white">üìä {{ selected_range|capitalize }} Price Summary</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-200">

              <div><strong>üí∞ Current Price:</strong> ${{ stats.current_price if stats.current_price is not none else 'N/A' }}</div>
              <div><strong>üìÖ Start of Period:</strong> ${{ stats.price_start if stats.price_start is not none else 'N/A' }}</div>

              <div>
                <strong>üìà % Change ({{ selected_range|capitalize }}):</strong>
                <span class="{% if stats.percent_change is not none and stats.percent_change > 0 %}text-green-600{% elif stats.percent_change is not none and stats.percent_change < 0 %}text-red-600{% else %}text-gray-500{% endif %}">
                  {{ stats.percent_change if stats.percent_change is not none else '0' }}%
                  {% if stats.percent_change is not none and stats.percent_change > 0 %}‚¨ÜÔ∏è{% elif stats.percent_change is not none and stats.percent_change < 0 %}‚¨áÔ∏è{% else %}‚è∏Ô∏è{% endif %}
                </span>
              </div>

              <div><strong>üìà High ({{ selected_range|capitalize }}):</strong> ${{ stats.high if stats.high is not none else 'N/A' }}</div>
              <div><strong>üìâ Low ({{ selected_range|capitalize }}):</strong> ${{ stats.low if stats.low is not none else 'N/A' }}</div>
              <div><strong>üìä Range ({{ selected_range|capitalize }}):</strong> ${{ stats.range if stats.range is not none else 'N/A' }}</div>

              {# SMAs are calculated based on number of data points, might not always align with selected_range #}
              {# Keeping existing SMA labels as they describe the window of the moving average itself #}
              <div><strong>üïê SMA (1h):</strong> ${{ stats.sma_1h if stats.sma_1h is not none else 'N/A' }}</div>
              <div><strong>üïì SMA (4h):</strong> ${{ stats.sma_4h if stats.sma_4h is not none else 'N/A' }}</div>
              <div><strong>üïõ SMA (24h):</strong> ${{ stats.sma_24h if stats.sma_24h is not none else 'N/A' }}</div>

              <div>
                <strong>üìä RSI (14):</strong>
                {% if stats.rsi is not none %}
                  <span class="{% if stats.rsi > 70 %}text-red-400 font-semibold{% elif stats.rsi < 30 %}text-green-400 font-semibold{% else %}text-gray-300{% endif %}">
                    {{ "%.2f"|format(stats.rsi) }}
                    {% if stats.rsi > 70 %} (Overbought ‚ö†Ô∏è){% elif stats.rsi < 30 %} (Oversold üìà){% else %} (Neutral){% endif %}
                  </span>
                {% else %}
                  <span class="text-gray-500">N/A</span>
                {% endif %}
              </div>

              <div>
                <strong>üéØ Std Dev:</strong>
                <span class="{% if stats.std_dev is not none and stats.std_dev > 2 %}text-red-500 font-semibold{% elif stats.std_dev is not none and stats.std_dev > 1 %}text-yellow-500{% else %}text-green-600{% endif %}">
                  ${{ stats.std_dev if stats.std_dev is not none else 'N/A' }}
                  {% if stats.std_dev is not none and stats.std_dev > 2 %}‚ö†Ô∏è{% elif stats.std_dev is not none and stats.std_dev > 1 %}üìâ{% else %}üëå{% endif %}
                </span>
              </div>

              <div><strong>üìâ Avg Œî / 5min:</strong> ${{ stats.avg_delta if stats.avg_delta is not none else 'N/A' }}</div>
            </div>
          </div>




          <!-- DEPRECATED: Recent Price Predictions (Commented Out) -->
          {# Price prediction has been disabled - keeping this section commented for reference
          <div x-data="{ showAll: false }" class="mt-8 bg-white p-6 rounded-lg shadow-lg border-2 border-yellow-300">
            <h2 class="text-xl font-semibold mb-2">üß† Recent Predictions <span class="text-sm text-yellow-600 font-normal">(Deprecated - Historical Data Only)</span></h2>
            <p class="text-sm text-gray-600 mb-4 italic">Price prediction has been disabled. The data below is historical and no new predictions are being generated.</p>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm text-left text-gray-700 border">
                <thead class="bg-gray-100 text-xs uppercase font-semibold text-gray-600">
                  <tr>
                    <th class="px-4 py-2 border-b">‚è±Ô∏è Timestamp</th>
                    <th class="px-4 py-2 border-b">üîÆ Predicted</th>
                    <th class="px-4 py-2 border-b">‚úÖ Actual</th>
                    <th class="px-4 py-2 border-b">üìâ Error</th>
                    <th class="px-4 py-2 border-b relative group">
                      üìä MAE
                      <span class="ml-1 text-gray-400 cursor-help">?</span>
                      <div class="absolute z-10 hidden group-hover:block bg-white text-xs text-gray-800 border rounded shadow-md p-2 w-64 top-full left-1/2 transform -translate-x-1/2 mt-1">
                        Mean Absolute Error (MAE) is the average difference between the predicted and actual SOL price. Lower is better.
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {% for p in predictions %}
                  <template x-if="showAll || {{ loop.index }} <= 5">
                    <tr class="hover:bg-gray-50">
                      <td class="px-4 py-2 border-b">{{ p.timestamp }}</td>
                      <td class="px-4 py-2 border-b">${{ p.predicted }}</td>
                      <td class="px-4 py-2 border-b">${{ p.actual }}</td>
                      <td class="px-4 py-2 border-b text-red-600">${{ p.error }}</td>
                      <td class="px-4 py-2 border-b text-blue-600">${{ p.mae }}</td>
                    </tr>
                  </template>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="mt-4 text-center">
              <button @click="showAll = !showAll" class="text-sm text-blue-600 hover:underline focus:outline-none">
                <span x-text="showAll ? 'Show Less' : 'Show All'"></span>
              </button>
            </div>
          </div>
          #}

          <!-- Technical Indicators Summary -->
          <div class="mt-8 bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700 fade-in">
            <h2 class="text-xl font-semibold mb-6 text-white">üìä Technical Indicators Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Moving Averages -->
              <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
                <h3 class="text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wide">Moving Averages</h3>
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span class="text-gray-400">SMA (1h)</span>
                    <span class="text-white font-semibold">${{ stats.sma_1h if stats.sma_1h is not none else 'N/A' }}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">SMA (4h)</span>
                    <span class="text-white font-semibold">${{ stats.sma_4h if stats.sma_4h is not none else 'N/A' }}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">SMA (24h)</span>
                    <span class="text-white font-semibold">${{ stats.sma_24h if stats.sma_24h is not none else 'N/A' }}</span>
                  </div>
                </div>
              </div>
              
              <!-- RSI Details -->
              <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
                <h3 class="text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wide">RSI Analysis</h3>
                <div class="space-y-2">
                  {% if stats.rsi is not none %}
                    <div class="flex justify-between">
                      <span class="text-gray-400">RSI (14)</span>
                      <span class="{% if stats.rsi > 70 %}text-red-400{% elif stats.rsi < 30 %}text-green-400{% else %}text-gray-300{% endif %} font-semibold">
                        {{ "%.2f"|format(stats.rsi) }}
                      </span>
                    </div>
                    <div class="mt-3">
                      {% if stats.rsi > 70 %}
                        <div class="text-xs text-red-300 bg-red-900/30 px-2 py-1 rounded">Overbought Zone</div>
                      {% elif stats.rsi < 30 %}
                        <div class="text-xs text-green-300 bg-green-900/30 px-2 py-1 rounded">Oversold Zone</div>
                      {% else %}
                        <div class="text-xs text-gray-400 bg-gray-600/30 px-2 py-1 rounded">Neutral Zone</div>
                      {% endif %}
                    </div>
                  {% else %}
                    <div class="text-gray-500">Insufficient data</div>
                  {% endif %}
                </div>
              </div>
              
              <!-- Volatility -->
              <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
                <h3 class="text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wide">Volatility</h3>
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span class="text-gray-400">Std Dev</span>
                    <span class="{% if stats.std_dev is not none and stats.std_dev > 2 %}text-red-400{% elif stats.std_dev is not none and stats.std_dev > 1 %}text-yellow-400{% else %}text-green-400{% endif %} font-semibold">
                      ${{ stats.std_dev if stats.std_dev is not none else 'N/A' }}
                    </span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">Avg Œî / 5min</span>
                    <span class="text-white font-semibold">${{ stats.avg_delta if stats.avg_delta is not none else 'N/A' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

    </div>


    <script>
      // Wait for TradingView library to load
      function initChart() {
      // Data from Flask
      const timestamps = {{ timestamps|tojson }};
      const prices = {{ prices|tojson }};
      const rsiValues = {{ rsi_values|tojson }};
      const unixTimestamps = {{ unix_timestamps|tojson }};

      // Debug: Log data to console
      console.log('Timestamps:', timestamps ? timestamps.length : 0);
      console.log('Prices:', prices ? prices.length : 0);
      console.log('Unix Timestamps:', unixTimestamps ? unixTimestamps.length : 0);
      console.log('Unix Timestamps type:', typeof unixTimestamps);
      console.log('Unix Timestamps value:', unixTimestamps);
      if (timestamps && timestamps.length > 0) {
          console.log('Sample data:', {
              firstTimestamp: timestamps[0],
              firstPrice: prices[0],
              firstUnix: unixTimestamps && unixTimestamps.length > 0 ? unixTimestamps[0] : 'undefined'
          });
      }

      // Prepare price data for TradingView (using Unix timestamps from server)
      const priceData = [];
      const timestampToIndex = {};
      
      if (timestamps.length !== prices.length || timestamps.length !== unixTimestamps.length) {
          console.error('Data length mismatch!', {
              timestamps: timestamps.length,
              prices: prices.length,
              unixTimestamps: unixTimestamps.length
          });
      }
      
      // Check if we have valid data
      if (!unixTimestamps || unixTimestamps.length === 0) {
          console.warn('WARNING: unixTimestamps is empty! Generating from formatted timestamps as fallback.');
          // Fallback: Generate Unix timestamps from formatted timestamps
          // This is less ideal but will work if server-side generation failed
          unixTimestamps = [];
          timestamps.forEach((ts, i) => {
              try {
                  // Parse "Nov 26, 06:38 PM" format
                  const date = new Date(ts);
                  if (!isNaN(date.getTime())) {
                      unixTimestamps.push(Math.floor(date.getTime() / 1000));
                  } else {
                      // If parsing fails, use current time as fallback (not ideal but prevents crash)
                      console.warn(`Failed to parse timestamp: ${ts}, using current time`);
                      unixTimestamps.push(Math.floor(Date.now() / 1000));
                  }
              } catch (e) {
                  console.error(`Error parsing timestamp ${ts}:`, e);
                  unixTimestamps.push(Math.floor(Date.now() / 1000));
              }
          });
          console.log('Generated', unixTimestamps.length, 'Unix timestamps as fallback');
      }
      
      if (timestamps && prices && unixTimestamps) {
          timestamps.forEach((ts, i) => {
              const unixTime = unixTimestamps[i];
              const price = prices[i];
              
              if (unixTime && price !== undefined && !isNaN(price) && price > 0) {
                  priceData.push({
                      time: unixTime,
                      value: price
                  });
                  timestampToIndex[ts] = i;
              }
          });
      } else {
          console.error('Missing required data arrays:', {
              hasTimestamps: !!timestamps,
              hasPrices: !!prices,
              hasUnixTimestamps: !!unixTimestamps
          });
      }

      console.log('Price data prepared:', priceData.length, 'points');
      if (priceData.length > 0) {
          console.log('First price point:', priceData[0]);
          console.log('Last price point:', priceData[priceData.length - 1]);
      }

      // Create RSI-based signal markers
      const buyMarkers = [];
      const sellMarkers = [];
      
      // Add markers based on RSI values (oversold = buy, overbought = sell)
      if (rsiValues && unixTimestamps && prices) {
          rsiValues.forEach((rsi, index) => {
              if (rsi !== null && rsi !== undefined && index < unixTimestamps.length && unixTimestamps[index]) {
                  const unixTime = unixTimestamps[index];
                  
                  // Buy signal: RSI < 30 (oversold)
                  if (rsi < 30) {
                      buyMarkers.push({
                          time: unixTime,
                          position: 'belowBar',
                          color: '#10b981',
                          shape: 'arrowUp',
                          text: 'BUY',
                          size: 1
                      });
                  }
                  // Sell signal: RSI > 70 (overbought)
                  else if (rsi > 70) {
                      sellMarkers.push({
                          time: unixTime,
                          position: 'aboveBar',
                          color: '#ef4444',
                          shape: 'arrowDown',
                          text: 'SELL',
                          size: 1
                      });
                  }
              }
          });
      }

      // Prepare RSI data
      const rsiData = [];
      if (rsiValues && unixTimestamps) {
          rsiValues.forEach((rsi, index) => {
              if (rsi !== null && rsi !== undefined && index < timestamps.length && unixTimestamps[index]) {
                  rsiData.push({
                      time: unixTimestamps[index],
                      value: rsi
                  });
              }
          });
      }
      
      console.log('RSI data prepared:', rsiData.length, 'points');

      // Professional Dark Theme Configuration
      const chartOptions = {
          layout: {
              background: { color: '#1a1a1a' },
              textColor: '#d1d5db',
          },
          grid: {
              vertLines: { color: '#2a2a2a', style: 1 },
              horzLines: { color: '#2a2a2a', style: 1 },
          },
          crosshair: {
              mode: 1,
              vertLine: {
                  color: '#6b7280',
                  width: 1,
                  style: 3,
              },
              horzLine: {
                  color: '#6b7280',
                  width: 1,
                  style: 3,
              },
          },
          rightPriceScale: {
              borderColor: '#2a2a2a',
              scaleMargins: {
                  top: 0.1,
                  bottom: 0.1,
              },
          },
          timeScale: {
              borderColor: '#2a2a2a',
              timeVisible: true,
              secondsVisible: false,
          },
      };

      // Create main price chart
      const chartContainer = document.getElementById('tradingview-chart');
      
      if (!chartContainer) {
          console.error('Chart container not found!');
      } else if (typeof LightweightCharts === 'undefined') {
          console.error('TradingView Lightweight Charts library not loaded!');
          chartContainer.innerHTML = '<div class="text-white p-4 text-center">Chart library failed to load. Please refresh the page.</div>';
      } else if (priceData.length === 0) {
          console.error('No price data available!');
          console.error('Debug info:', {
              timestampsLength: timestamps ? timestamps.length : 0,
              pricesLength: prices ? prices.length : 0,
              unixTimestampsLength: unixTimestamps ? unixTimestamps.length : 0,
              unixTimestampsType: typeof unixTimestamps,
              unixTimestampsValue: unixTimestamps
          });
          chartContainer.innerHTML = '<div class="text-white p-4 text-center">No price data available for the selected time range. Check console for details.</div>';
      } else {
          let chart, priceSeries, rsiChart, rsiSeries;
          
          try {
              console.log('Creating chart with', priceData.length, 'data points');
              console.log('LightweightCharts object:', typeof LightweightCharts, LightweightCharts);
              
              // Check if createChart exists
              if (!LightweightCharts || !LightweightCharts.createChart) {
                  throw new Error('LightweightCharts.createChart is not available. Library may not have loaded correctly.');
              }
              
              chart = LightweightCharts.createChart(chartContainer, {
                  ...chartOptions,
                  width: chartContainer.clientWidth,
                  height: 500,
              });

              console.log('Chart created:', chart);
              console.log('Chart methods:', Object.keys(chart).filter(k => k.includes('Series')));
              
              // Check if addLineSeries exists, if not try addSeries (v5.x API)
              if (typeof chart.addLineSeries === 'function') {
                  // v4.x API
                  priceSeries = chart.addLineSeries({
                      color: '#3b82f6',
                      lineWidth: 2,
                      priceFormat: {
                          type: 'price',
                          precision: 2,
                          minMove: 0.01,
                      },
                      lastValueVisible: true,
                      priceLineVisible: true,
                  });
              } else if (typeof chart.addSeries === 'function' && LightweightCharts.LineSeries) {
                  // v5.x API
                  priceSeries = chart.addSeries(LightweightCharts.LineSeries, {
                      color: '#3b82f6',
                      lineWidth: 2,
                      priceFormat: {
                          type: 'price',
                          precision: 2,
                          minMove: 0.01,
                      },
                      lastValueVisible: true,
                      priceLineVisible: true,
                  });
              } else {
                  throw new Error('Neither addLineSeries nor addSeries(LineSeries) is available. Chart library version issue.');
              }

              // Set price data
              if (priceData.length > 0) {
                  priceSeries.setData(priceData);
                  console.log('Price data set successfully');

                  // Add markers for buy/sell/hold signals
                  const allMarkers = [...buyMarkers, ...sellMarkers];
                  if (allMarkers.length > 0) {
                      priceSeries.setMarkers(allMarkers);
                      console.log('RSI-based markers set:', allMarkers.length, '(Buy:', buyMarkers.length, 'Sell:', sellMarkers.length, ')');
                  }
              } else {
                  console.error('No price data to display!');
                  // Show error message
                  chartContainer.innerHTML = '<div class="text-white p-4 text-center">No price data available for the selected time range.</div>';
              }

              // Update price display on crosshair move
              chart.subscribeCrosshairMove(param => {
                  if (param.point === undefined || !param.time || param.seriesData.size === 0) {
                      return;
                  }
                  const price = param.seriesData.get(priceSeries);
                  if (price) {
                      const currentPrice = price.value;
                      const firstPrice = prices[0];
                      const change = currentPrice - firstPrice;
                      const changePercent = ((change / firstPrice) * 100).toFixed(2);
                      
                      document.getElementById('chart-price').textContent = `$${currentPrice.toFixed(2)}`;
                      const changeEl = document.getElementById('chart-change');
                      changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent}%)`;
                      changeEl.className = change >= 0 ? 'ml-2 text-green-400' : 'ml-2 text-red-400';
                  }
              });

              // Create RSI chart below
              const rsiChartContainer = document.getElementById('rsi-chart');
              if (rsiChartContainer) {
                  rsiChart = LightweightCharts.createChart(rsiChartContainer, {
                      ...chartOptions,
                      height: 150,
                      rightPriceScale: {
                          ...chartOptions.rightPriceScale,
                          visible: true,
                          scaleMargins: {
                              top: 0.1,
                              bottom: 0.1,
                          },
                      },
                  });

                  // Check API version for RSI series
                  if (typeof rsiChart.addLineSeries === 'function') {
                      // v4.x API
                      rsiSeries = rsiChart.addLineSeries({
                          color: '#d97706',
                          lineWidth: 1,
                          priceFormat: {
                              type: 'price',
                              precision: 2,
                              minMove: 0.01,
                          },
                      });
                  } else if (typeof rsiChart.addSeries === 'function' && LightweightCharts.LineSeries) {
                      // v5.x API
                      rsiSeries = rsiChart.addSeries(LightweightCharts.LineSeries, {
                          color: '#d97706',
                          lineWidth: 1,
                          priceFormat: {
                              type: 'price',
                              precision: 2,
                              minMove: 0.01,
                          },
                      });
                  } else {
                      console.error('Cannot create RSI series - API not available');
                      rsiSeries = null;
                  }
                  
                  if (rsiSeries && rsiData.length > 0) {
                      rsiSeries.setData(rsiData);

                      // Add RSI overbought/oversold lines
                      rsiSeries.createPriceLine({
                          price: 70,
                          color: '#ef4444',
                          lineWidth: 1,
                          lineStyle: 2,
                          axisLabelVisible: true,
                          title: 'Overbought',
                      });

                      rsiSeries.createPriceLine({
                          price: 30,
                          color: '#10b981',
                          lineWidth: 1,
                          lineStyle: 2,
                          axisLabelVisible: true,
                          title: 'Oversold',
                      });
                  } else {
                      console.warn('No RSI data available');
                  }

                  // Synchronize crosshair between charts
                  if (chart && rsiChart && rsiSeries) {
                      chart.subscribeCrosshairMove(param => {
                          if (param.time && rsiChart) {
                              rsiChart.setCrosshairPosition(param.time, param.point);
                          }
                      });

                      rsiChart.subscribeCrosshairMove(param => {
                          if (param.time && chart) {
                              chart.setCrosshairPosition(param.time, param.point);
                          }
                      });

                      // Handle window resize
                      window.addEventListener('resize', () => {
                          if (chart) chart.applyOptions({ width: chartContainer.clientWidth });
                          if (rsiChart) rsiChart.applyOptions({ width: rsiChartContainer.clientWidth });
                      });
                  }
              } // Close rsiChartContainer if block
          } catch (error) {
              console.error('Error creating chart:', error);
              chartContainer.innerHTML = '<div class="text-white p-4 text-center">Error creating chart: ' + error.message + '</div>';
          }
      } // Close else block (priceData.length > 0)

      // Set initial price display
      if (prices && prices.length > 0) {
          const lastPrice = prices[prices.length - 1];
          const firstPrice = prices[0];
          const change = lastPrice - firstPrice;
          const changePercent = firstPrice > 0 ? ((change / firstPrice) * 100).toFixed(2) : '0.00';
          
          const priceEl = document.getElementById('chart-price');
          const changeEl = document.getElementById('chart-change');
          
          if (priceEl) {
              priceEl.textContent = `$${lastPrice.toFixed(2)}`;
          }
          
          if (changeEl) {
              changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent}%)`;
              changeEl.className = change >= 0 ? 'ml-2 text-green-400' : 'ml-2 text-red-400';
          }
      } else {
          console.warn('No prices available for display');
          const priceEl = document.getElementById('chart-price');
          if (priceEl) {
              priceEl.textContent = 'No Data';
          }
      }
      } // End initChart function
      
      // Wait for library to load, then initialize chart
      if (typeof LightweightCharts !== 'undefined') {
          initChart();
      } else {
          // Wait for library to load
          window.addEventListener('load', function() {
              if (typeof LightweightCharts !== 'undefined') {
                  initChart();
              } else {
                  console.error('TradingView Lightweight Charts failed to load');
                  const chartContainer = document.getElementById('tradingview-chart');
                  if (chartContainer) {
                      chartContainer.innerHTML = '<div class="text-white p-4 text-center">Chart library failed to load. Please refresh the page.</div>';
                  }
              }
          });
      }
  </script>
</body>
</html>
